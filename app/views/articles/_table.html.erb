<table class="articles-table">
  <thead>
    <tr>
      <th scope="col">Site</th>
      <th scope="col">Permalink</th>
      <th scope="col">Title</th>
      <th scope="col">Description</th>
      <th scope="col">Noindex</th>
      <th scope="col">Published At</th>
      <th scope="col">Modified At</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% articles.each do |article| %>
      <tr class="<%= article.permalink.state %>">
        <td scope="row">
          <%= link_to article.permalink.site.domain,
                      "//#{article.permalink.site.domain}#{request.port_string}/",
                      target: :_blank %>
        </td>
        <td data-controller='editable-cell'>
          <% if article.permalink.shipped? %>
            <%= link_to_if article.permalink.shipped?,
                           "/#{article.permalink.path}",
                           "//#{article.permalink.site.domain}#{request.port_string}/#{article.permalink.path}",
                           target: :_blank %>
          <% else %>
            <div data-action="click->editable-cell#edit" data-target="editable-cell.show" class='field permalink-prefix'>
              <%= "#{article.permalink.path}" %>
            </div>
            <%= form_with(model: article, data: {target: 'editable-cell.form',
                                                 action: 'ajax:send->editable-cell#loading
                                                          ajax:complete->editable-cell#hide
                                                          ajax:error->editable-cell#error'}, class: 'hide') do |form| %>
              <div class="field flex-container">
                <div><span>/ <span></div>
                <div><%= form.text_field :permalink, data: {target: 'editable-cell.input', action: 'blur->editable-cell#show'} %></div>
              </div>
            <% end %>
          <% end %>
        </td>
        <td data-controller='editable-cell'>
          <div data-action="click->editable-cell#edit" data-target="editable-cell.show" class='field'>
            <%= article.permalink.title %>
          </div>
          <%= form_with(model: article, data: {target: 'editable-cell.form',
                                               action: 'ajax:send->editable-cell#loading
                                                        ajax:complete->editable-cell#hide
                                                        ajax:error->editable-cell#error'}, class: 'hide') do |form| %>
            <div class="field">
              <%= form.text_field :title, data: {target: 'editable-cell.input', action: 'blur->editable-cell#show'} %>
            </div>
          <% end %>
        </td>
        <td data-controller='editable-cell'>
          <div data-action="click->editable-cell#edit" data-target="editable-cell.show" class='field'>
            <%= article.permalink.description %>
          </div>
          <%= form_with(model: article, data: {target: 'editable-cell.form',
                                               action: 'ajax:send->editable-cell#loading
                                                        ajax:complete->editable-cell#hide
                                                        ajax:error->editable-cell#error'}, class: 'hide') do |form| %>
            <div class="field">
              <%= form.text_field :description, data: {target: 'editable-cell.input', action: 'blur->editable-cell#show'} %>
            </div>
          <% end %>
        </td>
        <td><%= 'noindex' if article.permalink.noindex? %></td>
        <td><%= article.permalink.published_at.to_s(:db) if article.permalink.published_at %></td>
        <td><%= article.permalink.modified_at.to_s(:db) if article.permalink.modified_at %></td>
        <td><%= link_to 'Edit', edit_article_path(article) %></td>
        <td><%= link_to 'Destroy', article, method: :delete, data: { confirm: 'Are you sure?' } %></td>
        <td><%= link_to 'History', article_histories_path(article) %></td>
      </tr>
    <% end %>
  </tbody>
</table>
